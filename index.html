<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ch√∫c m·ª´ng 20-10 ‚Äî Thi·ªáp & ƒê·∫∑t qu√†</title>
  <meta name="description" content="Thi·ªáp ch√∫c m·ª´ng Ng√†y Ph·ª• N·ªØ Vi·ªát Nam 20-10." />
  <meta name="theme-color" content="#f43f5e" />

  <!-- Open Graph -->
  <meta property="og:title" content="Ch√∫c m·ª´ng 20-10 ‚Äî Thi·ªáp & ƒê·∫∑t qu√†" />
  <meta property="og:description" content="Thi·ªáp ch√∫c m·ª´ng Ng√†y Ph·ª• N·ªØ Vi·ªát Nam 20-10." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tungbui198.github.io/happy-20-10/" />
  <meta property="og:image" content="https://tungbui198.github.io/happy-20-10/og-1200x630.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {50:'#fff1f2',100:'#ffe4e6',200:'#fecdd3',300:'#fda4af',400:'#fb7185',500:'#f43f5e',600:'#e11d48',700:'#be123c',800:'#9f1239',900:'#881337'}
          }
        }
      }
    };
  </script>

  <!-- Icon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cpath fill='%23f43f5e' d='M128 228s92-52 92-124a52 52 0 0 0-100-20a52 52 0 0 0-100 20c0 72 108 124 108 124Z'/%3E%3C/svg%3E"/>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js" defer></script>

  <style>
    /* Base polish */
    .glass { backdrop-filter: blur(8px); background: rgba(255,255,255,0.75); }
    .gradient-text { background: linear-gradient(90deg,#f43f5e,#fb7185,#e11d48); -webkit-background-clip:text; background-clip:text; color:transparent; }

    /* Rose */
    .rose-wrap{position:relative;display:inline-flex;align-items:center;justify-content:center}
    .rose-wrap::before{content:"";position:absolute;inset:auto;width:140px;height:140px;border-radius:999px;background:radial-gradient(closest-side,rgba(244,63,94,.25),rgba(244,63,94,0));filter:blur(6px);transform:translateZ(0)}
    .rose-emoji{font-size:64px;display:inline-block;transform-origin:50% 80%;animation:rose-bloom .9s ease-out both, rose-float 4s ease-in-out .9s infinite}
    .rose-emoji.spin{animation:rose-bloom .6s ease-out both, rose-spin 4s linear .6s infinite}
    @keyframes rose-bloom{0%{transform:scale(.6) rotate(-10deg);opacity:0;filter:saturate(.7)}60%{opacity:1}100%{transform:scale(1) rotate(0);opacity:1;filter:saturate(1)}}
    @keyframes rose-float{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
    @keyframes rose-spin{to{transform:rotate(1turn)}}
    .fade-in{animation:fadeIn .9s ease-out both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    /* Tap target */
    button,[role="button"],.btn{min-height:44px}

    /* Petals background */
    .petals{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:0}
    .petals span{position:absolute;top:-10vh;font-size:18px;filter:drop-shadow(0 1px 1px rgba(0,0,0,.12));animation:fall var(--dur,12s) linear var(--delay,0s) infinite;opacity:.85}
    @keyframes fall{to{transform:translate3d(var(--x,0),120vh,0) rotate(var(--rot,1turn))}}

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .fade-in{animation:none}
      .petals{display:none}
    }

    /* ===== Modal improvements ===== */
    .modal-open{overflow: hidden;} /* lock body scroll when modal open */

    /* Container fills viewport (mobile-safe with dynamic viewport units) */
    .modal-viewport{
      position: fixed;
      inset: 0;
      z-index: 50;
      /* use dvh to avoid mobile url bar issue */
      height: 100dvh;
      width: 100vw;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    /* Allow overlay click */
    .modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.4)}
    /* Panel: max height <= viewport, internal scroll */
    .modal-panel{
      position: relative;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
      width: 100%;
      max-width: 640px;
      max-height: calc(100dvh - 24px - 24px); /* keep breathing room */
      display: flex;
      flex-direction: column;
      overflow: hidden;           /* clip rounded corners */
    }
    .modal-content{
      overflow-y: auto;           /* scroll inside panel */
      -webkit-overflow-scrolling: touch;
      padding: 16px 16px 8px 16px;
    }
    .modal-header{
      padding: 12px 48px 0 16px; /* leave space for close button */
    }
    .modal-footer{
      padding: 8px 16px 16px 16px;
      border-top: 1px solid #f1f5f9;
      background: #fff;
      position: sticky;
      bottom: 0;                  /* keep actions visible while scrolling */
    }
    .modal-close{
      position: absolute; right: 10px; top: 8px; font-size: 24px; line-height: 1; color:#94a3b8;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-rose-50 via-pink-50 to-rose-100 text-slate-800 selection:bg-brand-200">
  <!-- Hero -->
  <header class="relative overflow-hidden">
    <div class="petals" aria-hidden="true" id="petals"></div>
    <div class="mx-auto max-w-5xl px-6 pt-12 pb-4 text-center">
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold tracking-tight gradient-text">Ch√∫c m·ª´ng Ng√†y Ph·ª• N·ªØ Vi·ªát Nam 20-10</h1>
    </div>
  </header>

  <!-- Card -->
  <main class="mx-auto max-w-5xl px-6 pb-24">
    <section class="relative">
      <div class="mx-auto max-w-3xl rounded-3xl glass shadow-xl p-6 sm:p-8 fade-in">
        <div class="flex flex-col md:flex-row items-center gap-6">
          <!-- Illustration -->
          <div class="w-full md:w-1/2">
            <div class="aspect-[4/3] w-full overflow-hidden rounded-2xl shadow-md">
              <div class="w-full h-full bg-gradient-to-br from-rose-200 via-rose-100 to-pink-100 flex items-center justify-center">
                <div class="text-center px-4">
                  <button id="roseBtn" class="rose-wrap" title="B·∫•m ƒë·ªÉ xoay hoa h·ªìng" aria-label="Hoa h·ªìng 20-10">
                    <span id="rose" class="rose-emoji">üåπ</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- Content -->
          <div class="w-full md:w-1/2">
            <h2 class="mt-1 text-2xl sm:text-3xl font-bold">G·ª≠i t·ªõi <span id="toName" class="gradient-text">B·∫°n</span> üíê</h2>
            <p id="wishText" class="mt-3 text-slate-700 leading-relaxed">
              Ch√∫c b·∫°n lu√¥n r·∫°ng r·ª°, h·∫°nh ph√∫c v√† th√†nh c√¥ng. C·∫£m ∆°n v√¨ ƒë√£ lu√¥n truy·ªÅn c·∫£m h·ª©ng v√† lan to·∫£ y√™u th∆∞∆°ng! üíñ
            </p>
            <div class="mt-4 text-sm text-slate-500" id="fromLine"></div>

            <!-- Buttons: 2 n√∫t 1 h√†ng, n√∫t ƒë·∫∑t qu√† n·∫±m d∆∞·ªõi full width -->
            <div class="mt-6 grid grid-cols-2 gap-3 w-full">
              <button id="nextWishBtn" class="btn w-full inline-flex items-center justify-center gap-2 rounded-full border border-rose-200 px-5 py-3 hover:bg-rose-50 active:scale-[.98]">üíå L·ªùi ch√∫c</button>
              <button id="confettiBtn" class="btn w-full inline-flex items-center justify-center gap-2 rounded-full border border-rose-200 px-5 py-3 hover:bg-rose-50 active:scale-[.98]">‚ú® Tung hoa</button>
              <button id="openGiftBtn" class="btn w-full col-span-2 inline-flex items-center justify-center gap-2 rounded-full bg-brand-600 px-5 py-3 text-white shadow hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-400 active:scale-[.98]">üéÅ ƒê·∫∑t qu√† ngay</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="orderModal" class="hidden">
    <div class="modal-viewport" role="dialog" aria-modal="true" aria-labelledby="orderTitle">
      <div class="modal-backdrop" data-close-modal></div>

      <div class="modal-panel">
        <button class="modal-close hover:text-slate-600" title="ƒê√≥ng" aria-label="ƒê√≥ng" data-close-modal>&times;</button>

        <div class="modal-header">
          <h3 id="orderTitle" class="text-lg font-semibold">ƒê·∫∑t qu√† t·∫∑ng (ƒë·ªì u·ªëng)</h3>
          <p class="mt-1 text-xs text-slate-500">B·∫•m v√†o m√≥n trong th·ª±c ƒë∆°n ƒë·ªÉ ch·ªçn nhanh.</p>
        </div>

        <div class="modal-content">
          <!-- Menu -->
          <div class="mt-3">
            <div class="flex items-center justify-between">
              <h4 class="text-sm font-semibold">Th·ª±c ƒë∆°n g·ª£i √Ω (Highlands)</h4>
              <button id="toggleMenu" class="text-xs underline hover:no-underline">Thu g·ªçn/M·ªü</button>
            </div>
            <div id="menuGrid" class="mt-3 grid grid-cols-2 sm:grid-cols-3 gap-3 max-h-60 overflow-auto pr-1"></div>
          </div>

          <!-- Form -->
          <form id="orderForm" class="mt-4 space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <label class="block">
                <span class="text-sm">Ng∆∞·ªùi nh·∫≠n</span>
                <input name="to" id="fTo" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:border-brand-400 focus:ring-brand-200" placeholder="VD: Ch·ªã Lan" required />
              </label>
              <label class="block">
                <span class="text-sm">Ng∆∞·ªùi g·ª≠i</span>
                <input name="name" id="fFrom" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 focus:border-brand-400 focus:ring-brand-200" placeholder="T√™n c·ªßa b·∫°n" required />
              </label>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <label class="block">
                <span class="text-sm">S·ªë ƒëi·ªán tho·∫°i</span>
                <input name="phone" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" inputmode="tel" placeholder="09xxxxxxxx" required />
              </label>
              <label class="block">
                <span class="text-sm">Lo·∫°i ƒë·ªì u·ªëng</span>
                <select name="drink" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" required></select>
              </label>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <label class="block">
                <span class="text-sm">S·ªë l∆∞·ª£ng</span>
                <input name="qty" type="number" min="1" value="1" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" required />
              </label>
              <label class="block">
                <span class="text-sm">Th·ªùi gian giao</span>
                <input name="deliveryTime" type="datetime-local" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" />
              </label>
            </div>

            <label class="block">
              <span class="text-sm">ƒê·ªãa ch·ªâ giao</span>
              <input name="address" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, qu·∫≠n/huy·ªán, TP" required />
            </label>

            <label class="block">
              <span class="text-sm">Ghi ch√∫</span>
              <textarea name="note" rows="3" class="mt-1 w-full rounded-lg border border-slate-200 px-3 py-2" placeholder="Khung gi·ªù nh·∫≠n, l∆∞u √Ω th√™m‚Ä¶"></textarea>
            </label>

            <div class="h-2"></div> <!-- spacer to avoid footer overlap on iOS -->
          </form>
        </div>

        <div class="modal-footer flex items-center justify-between">
          <div id="formStatus" class="text-xs text-slate-500"></div>
          <button id="submitBtn" class="inline-flex items-center gap-2 rounded-full bg-brand-600 px-5 py-2.5 text-white shadow hover:bg-brand-700">G·ª≠i ƒë∆°n</button>
        </div>

        <!-- Google Form fallback (hidden) -->
        <form id="gform" method="POST" class="hidden" target="hidden_iframe"></form>
        <iframe name="hidden_iframe" class="hidden"></iframe>
      </div>
    </div>
  </div>

  <footer class="pb-10 text-center text-xs text-slate-500">
    <div class="mx-auto max-w-5xl px-6">Made with ‚ù§Ô∏è for 20-10</div>
  </footer>

  <script>
    // =====================
    // CONFIG
    // =====================
    const CONFIG = {
      APPS_SCRIPT_ENDPOINT: 'https://script.google.com/macros/s/AKfycbyqTi1y6bxh6ITn0M7g12cQSjDOaFCfbphCrgci4Knn2qZlaqwXIfx1vcIe2t_z10LF/exec',
      USE_GOOGLE_FORM: false,  // n·∫øu mu·ªën √©p d√πng Google Form, b·∫≠t true
      GOOGLE_FORM_ACTION: 'https://docs.google.com/forms/d/e/FORM_ID/formResponse',
      GOOGLE_FORM_ENTRIES: {
        timestamp: 'entry.1111111111',
        to: 'entry.2222222222',
        name: 'entry.3333333333',
        phone: 'entry.4444444444',
        address: 'entry.5555555555',
        drink: 'entry.6666666666',
        qty: 'entry.7777777777',
        deliveryTime: 'entry.8888888888',
        note: 'entry.9999999999',
        utm: 'entry.1212121212'
      }
    };

    // Menu
    const MENU = [
      { name: 'Phin S·ªØa ƒê√°', id: 'milk-coffee' },
      { name: 'Phin ƒêen ƒê√°', id: 'black-coffee' },
      { name: 'B·∫°c X·ªâu', id: 'iced-white-coffee' },
      { name: 'Tr√† Sen V√†ng', id: 'lotus-tea' },
      { name: 'Tr√† Th·∫°ch ƒê√†o', id: 'peach-tea' },
      { name: 'Tr√† Th·∫°ch V·∫£i', id: 'lychee-tea' },
      { name: 'Tr√† Xanh ƒê·∫≠u ƒê·ªè', id: 'bean-tea' },
      { name: 'PhinDi H·∫°nh Nh√¢n', id: 'almod-iced-coffee' },
      { name: 'PhinDi Kem S·ªØa', id: 'milk-foam-iced-coffee' },
      { name: 'PhinDi Choco', id: 'chocolate-iced-coffee' },
      { name: 'Freeze Tr√† Xanh (Green Tea Freeze)', id: 'green-tea-freeze' },
      { name: 'Cookies & Cream', id: 'cookies-freeze' },
      { name: 'Freeze S√¥-c√¥-la (Chocolate Freeze)', id: 'chocolate-freeze' },
      { name: 'Caramel Phin Freeze', id: 'caramel-phin-freeze' },
      { name: 'Classic Phin Freeze', id: 'classic-phin-freeze' }
    ];

    const $ = (sel, root=document)=>root.querySelector(sel);
    const params = new URLSearchParams(location.search);

    const WISHES = [
      "Ch√∫c b·∫°n lu√¥n xinh ƒë·∫πp, m·∫°nh m·∫Ω v√† to·∫£ s√°ng nh∆∞ ch√≠nh b·∫°n! üå∑",
      "Ch√∫c ng√†y 20/10 tr√†n ng·∫≠p n·ª• c∆∞·ªùi, y√™u th∆∞∆°ng v√† b√¨nh an. üíñ",
      "Ch√∫c b·∫°n nh·∫≠n v·ªÅ th·∫≠t nhi·ªÅu hoa, qu√† v√† nh·ªØng l·ªùi n√≥i d·ªãu d√†ng h√¥m nay! üå∏",
      "Mong m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp s·∫Ω ƒë·∫øn v·ªõi b·∫°n ‚Äî h√¥m nay v√† m·ªói ng√†y sau ƒë√≥. ‚ú®",
      "C·∫£m ∆°n b·∫°n ƒë√£ lu√¥n lan to·∫£ s·ª± ·∫•m √°p. Ch√∫c 20/10 r·ª±c r·ª° v√† ƒë√°ng nh·ªõ! üíê",
      "Ch√∫c b·∫°n lu√¥n h·∫°nh ph√∫c, kho·∫ª ƒë·∫πp v√† th√†nh c√¥ng tr√™n m·ªçi h√†nh tr√¨nh. üåü",
      "Ng√†y c·ªßa b·∫°n ‚Äì h√£y t·∫≠n h∆∞·ªüng th·∫≠t tr·ªçn v·∫πn! Ch√∫c 20/10 ng·ªçt ng√†o! üç∞",
      "Ch√∫c m·ªçi ∆∞·ªõc m∆° c·ªßa b·∫°n s·ªõm th√†nh hi·ªán th·ª±c. Happy 20/10! üéÄ",
      "Ch√∫c b·∫°n b√¨nh an, r·∫°ng r·ª° v√† lu√¥n ƒë∆∞·ª£c y√™u th∆∞∆°ng. üíû"
    ];
    let wishIndex = Math.floor(Math.random()*WISHES.length);

    function setWish(idx){
      const el = $('#wishText');
      el.style.opacity = .001;
      requestAnimationFrame(()=>{
        el.textContent = WISHES[idx % WISHES.length];
        el.style.transition = 'opacity .35s ease';
        el.style.opacity = 1;
      });
    }

    function launchConfetti(){
      if(window.confetti){
        const isMobile = matchMedia('(max-width: 640px)').matches;
        const duration = 900, end = Date.now()+duration;
        (function frame(){
          confetti({particleCount: isMobile?4:8, spread:70, origin:{y:.6}});
          if(Date.now()<end) requestAnimationFrame(frame);
        })();
      }
    }

    function openModal(){
      $('#orderModal').classList.remove('hidden');
      document.body.classList.add('modal-open');
      renderMenu();
      $('#fTo')?.focus();
    }
    function closeModal(){
      $('#orderModal').classList.add('hidden');
      document.body.classList.remove('modal-open');
    }

    // Init card
    (function initCard(){
      const to = params.get('to');
      const from = params.get('from');
      if(to){ $('#toName').textContent = decodeURIComponent(to); $('#toName').dataset.raw = decodeURIComponent(to); }
      else { $('#toName').dataset.raw = 'B·∫°n'; }
      if(from){
        const name = decodeURIComponent(from);
        $('#fromLine').textContent = `‚Äî T·ª´ ${name}`;
        $('#fromLine').dataset.raw = name;
      }
      $('#fTo').value = $('#toName').dataset.raw || '';
      $('#fFrom').value = $('#fromLine').dataset.raw || '';

      setWish(wishIndex);
      setTimeout(launchConfetti, 400);

      const petals = $('#petals');
      const count = matchMedia('(max-width: 640px)').matches ? 10 : 18;
      for(let i=0;i<count;i++){
        const s=document.createElement('span');
        s.textContent = Math.random()>.5?'üåπ':'üíó';
        const delay=(Math.random()*8).toFixed(2)+'s';
        const dur=(10+Math.random()*10).toFixed(2)+'s';
        const x=(Math.random()*100-50).toFixed(0)+'vw';
        const rot=(Math.random()*2+.5).toFixed(2)+'turn';
        s.style.left=Math.round(Math.random()*100)+'vw';
        s.style.setProperty('--delay',delay);
        s.style.setProperty('--dur',dur);
        s.style.setProperty('--x',x);
        s.style.setProperty('--rot',rot);
        petals.appendChild(s);
      }
    })();

    // UI handlers
    $('#confettiBtn').addEventListener('click', ()=>{ launchConfetti(); if(navigator.vibrate) navigator.vibrate(10); });
    $('#nextWishBtn').addEventListener('click', ()=>{ wishIndex=(wishIndex+1)%WISHES.length; setWish(wishIndex); if(navigator.vibrate) navigator.vibrate(6); });
    $('#openGiftBtn').addEventListener('click', openModal);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });
    document.addEventListener('click', (e)=>{ if(e.target && e.target.matches('[data-close-modal]')) closeModal(); });
    $('#toggleMenu').addEventListener('click', ()=>{ $('#menuGrid').classList.toggle('hidden'); });

    $('#roseBtn').addEventListener('click', ()=>{ $('#rose').classList.toggle('spin'); if(navigator.vibrate) navigator.vibrate(10); });

    function renderMenu(){
      const grid = $('#menuGrid');
      if(!grid || grid.dataset.rendered==='1') return;
      const frag = document.createDocumentFragment();
      MENU.forEach(item=>{
        const card = document.createElement('button');
        card.type='button';
        card.className='text-left rounded-xl border border-rose-100 hover:border-rose-300 bg-rose-50/50 p-3 shadow-sm hover:shadow-md transition focus:outline-none focus:ring-2 focus:ring-brand-300';
        card.innerHTML = `
          <div class="text-[13px] font-semibold line-clamp-2 mb-2">${item.name}</div>
          <span class="inline-flex items-center text-[11px] rounded-full border border-rose-200 px-2 py-1 text-rose-700 bg-white">Ch·ªçn</span>
        `;
        card.addEventListener('click', ()=>{
          const sel = document.querySelector('select[name="drink"]');
          if(sel){
            let opt = Array.from(sel.options).find(o=>o.value===item.name);
            if(!opt){ opt = new Option(item.name, item.name); sel.add(opt); }
            sel.value = item.name;
            document.querySelector('input[name="qty"]').focus();
          }
        });
        frag.appendChild(card);
      });
      grid.appendChild(frag);
      grid.dataset.rendered='1';

      // Populate select once
      const sel = document.querySelector('select[name="drink"]');
      if(sel && !sel.dataset.ready){
        sel.add(new Option('-- Ch·ªçn m√≥n --',''));
        MENU.forEach(item=> sel.add(new Option(item.name,item.name)));
        sel.dataset.ready = '1';
      }
    }

    // =====================
    // SUBMIT (with CORS fallbacks)
    // =====================
    const statusEl = $('#formStatus');
    const submitBtn = $('#submitBtn');

    function setStatus(msg){ statusEl.textContent = msg || ''; }

    // Google Form fallback submit
    function submitViaFormMap(action, map){
      const form = $('#gform');
      form.action = action; form.method='POST'; form.innerHTML='';
      Object.entries(map).forEach(([k,v])=>{
        const inp=document.createElement('input'); inp.type='hidden'; inp.name=k; inp.value=v??''; form.appendChild(inp);
      });
      form.submit();
    }

    // Build payload from form
    function readPayload(){
      const fd = new FormData($('#orderForm'));
      const payload = Object.fromEntries(fd.entries());
      payload.utm = params.toString();
      return payload;
    }

    // Submit apps script with different strategies
    async function submitAppsScript(payload){
      // Strategy A: try CORS JSON first (if server has proper headers)
      try{
        const res = await fetch(CONFIG.APPS_SCRIPT_ENDPOINT, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload),
          mode: 'cors',             // explicit
          credentials: 'omit'
        });
        // Try parse json, else rely on res.ok
        let ok = false;
        try{ const j = await res.json(); ok = !!j.ok; }catch(_){ ok = res.ok; }
        if(!ok) throw new Error('Bad response');
        return true;
      }catch(e){
        // fallthrough
      }

      // Strategy B: no-cors (opaque) ‚Äî will not throw if reachable; we assume ok
      try{
        await fetch(CONFIG.APPS_SCRIPT_ENDPOINT, {
          redirect: "follow",
          method: 'POST',
          headers: {'Content-Type': 'text/plain;charset=utf-8'}, // simple request to reduce preflight
          body: JSON.stringify(payload),
          mode: 'no-cors',
          credentials: 'omit'
        });
        return true; // opaque: assume success to avoid blocking UX
      }catch(e){
        return false;
      }
    }

    // Google Form mapping
    function googleFormMap(payload){
      const m = CONFIG.GOOGLE_FORM_ENTRIES, map={};
      map[m.to]=payload.to;
      map[m.name]=payload.name;
      map[m.phone]=payload.phone;
      map[m.address]=payload.address;
      map[m.drink]=payload.drink;
      map[m.qty]=payload.qty;
      map[m.deliveryTime]=payload.deliveryTime;
      map[m.note]=payload.note;
      map[m.utm]=payload.utm;
      return map;
    }

    // Wire submit
    submitBtn.addEventListener('click', async ()=>{
      const form = $('#orderForm');
      if(!form.reportValidity()) return;

      const payload = readPayload();
      setStatus('ƒêang g·ª≠i‚Ä¶'); submitBtn.disabled = true;

      // If forced Google Form
      if(CONFIG.USE_GOOGLE_FORM){
        submitViaFormMap(CONFIG.GOOGLE_FORM_ACTION, googleFormMap(payload));
        setStatus('ƒê√£ g·ª≠i! C·∫£m ∆°n b·∫°n ‚ô•'); launchConfetti(); form.reset(); submitBtn.disabled = false; return;
      }

      // Try Apps Script, then fallback to Google Form if everything fails
      const ok = await submitAppsScript(payload);
      if(ok){
        setStatus('ƒê√£ g·ª≠i! C·∫£m ∆°n b·∫°n ‚ô•');
        launchConfetti(); form.reset();
      }else{
        // Strategy C: Google Form fallback
        submitViaFormMap(CONFIG.GOOGLE_FORM_ACTION, googleFormMap(payload));
        setStatus('ƒê√£ g·ª≠i! (Fallback Google Form) ‚ô•');
        launchConfetti(); form.reset();
      }
      submitBtn.disabled = false;
    });
  </script>
</body>
</html>
